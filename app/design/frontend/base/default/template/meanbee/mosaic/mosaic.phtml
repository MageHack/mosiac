<?php
    $_products = $this->getLoadedProductCollection();
    $_helper = $this->helper('catalog/output');
?>

<div id="mosaic_container">
    <?php foreach($_products as $_product): ?>
        <div class="box col<?php echo rand(1, 3) ?>">
            <img src="<?php echo $this->helper('catalog/image')->init($_product, 'image')->resize(500); ?>" />
        </div>
    <?php endforeach ?>
</div>


<script type="text/javascript">
    $j(function() {
        $j('#mosaic_container').masonry({
            itemSelector: '.box',
            columnWidth: 100,
            isAnimated: true
        });


        $j('#mosaic_container .box').click(function() {

            $j('#mosaic_container').animate({width: '300px'}, {duration: 1000, complete: function() {
                $j('#mosaic_container').masonry('reload');
            }});
        })
    })
</script>