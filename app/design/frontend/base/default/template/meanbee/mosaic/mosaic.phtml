<?php
    $_products = $this->getLoadedProductCollection();
    $_coreHelper = $this->helper('core');
    $_taxHelper = $this->helper('tax');
?>
<h1 class="mosaic-title"><?php echo Mage::getStoreConfig('general/store_information/name') ?></h1>

<div id="mosaic_container">
    <?php foreach($_products as $_product): ?>
        <div class="box col<?php echo $_product->getBestsellerGroup() ?>">
            <img src="<?php echo $this->helper('catalog/image')->init($_product, 'image')->resize(500); ?>" />
            <div style="display:none" class="summary">
                <p class="product-name"><?php echo $_product->getName() ?></p>
                <p><?php echo $_coreHelper->currency($_taxHelper->getPrice($_product, $_product->getFinalPrice(), true)) ?></p>
                <a href="#" class="more-info" onclick="return false;">i</a>
            </div>
            <div style="display:none" class="details">
                <h1><?php echo $_product->getName() ?></h1>
                <p><?php echo $_coreHelper->currency($_taxHelper->getPrice($_product, $_product->getFinalPrice(), true)) ?></p>
                <p><?php echo $_product->getShortDescription() ?></p>
            </div>
        </div>
    <?php endforeach ?>
</div>

<script type="text/javascript">
    $j(function() {
        $j('#mosaic_container').masonry({
            itemSelector: '.box',
            columnWidth: 100,
            isAnimated: true
        });

        $j('#mosaic_container .box').click(function() {

            $j('#mosaic_container .box').removeClass('expanded');
            $j('#mosaic_container .box').css({zIndex: ''});
            $j('#mosaic_container .box .summary').fadeOut(100);


            $j(this).addClass('expanded');
            $j(this).find('.summary').fadeIn(100);

            $j(this).css({zIndex: 999});

            setTimeout(function() {
                $j('#mosaic_container').masonry('reload');
            }, 100);

        })

    })
</script>